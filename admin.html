<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AURA å¾Œå°ç®¡ç†ç³»çµ±</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=DM+Sans:wght@300;400;500;600&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”§ è¨­å®šå€ï¼šè«‹å¡«å…¥ä½ è‡ªå·±çš„é‡‘é‘°
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
  window.AURA_CONFIG = {
    // â”€â”€ Cloudinaryï¼ˆåœ–ç‰‡ä¸Šå‚³ï¼‰â”€â”€
    // å‰å¾€ https://cloudinary.com è¨»å†Šå¾Œï¼Œåœ¨ Dashboard å–å¾—
    CLOUDINARY_CLOUD_NAME: 'YOUR_CLOUD_NAME',       // ä¾‹å¦‚ 'mystore123'
    CLOUDINARY_UPLOAD_PRESET: 'YOUR_UPLOAD_PRESET', // åœ¨ Settings > Upload > Add upload presetï¼ŒMode è¨­ç‚º Unsigned

    // â”€â”€ Firebaseï¼ˆè³‡æ–™åº«ï¼‰â”€â”€
    // å‰å¾€ https://console.firebase.google.com å»ºç«‹å°ˆæ¡ˆå¾Œå–å¾—
    FIREBASE_API_KEY:       'YOUR_FIREBASE_API_KEY',
    FIREBASE_AUTH_DOMAIN:   'YOUR_PROJECT_ID.firebaseapp.com',
    FIREBASE_PROJECT_ID:    'YOUR_PROJECT_ID',
    FIREBASE_STORAGE_BUCKET:'YOUR_PROJECT_ID.appspot.com',
    FIREBASE_MESSAGING_ID:  'YOUR_MESSAGING_SENDER_ID',
    FIREBASE_APP_ID:        'YOUR_FIREBASE_APP_ID',
  };
</script>

<!-- Firebase SDK (v9 compat) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0F0F0D;
  --surface: #181816;
  --surface2: #222220;
  --surface3: #2A2A28;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(255,255,255,0.13);
  --text: #F0EFEB;
  --text-mid: rgba(240,239,235,0.55);
  --text-dim: rgba(240,239,235,0.3);
  --rose: #C4747A;
  --rose-dark: #A55E63;
  --rose-pale: rgba(196,116,122,0.12);
  --gold: #B89A6A;
  --gold-pale: rgba(184,154,106,0.12);
  --green: #7AAA7E;
  --green-pale: rgba(122,170,126,0.12);
  --line: #06C755;
  --sidebar-w: 240px;
}

body { font-family: 'DM Sans','Noto Sans TC',sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; }

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar { width: var(--sidebar-w); background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; position: fixed; top:0; bottom:0; left:0; z-index:50; }
.sidebar-logo { padding: 26px 24px 22px; border-bottom: 1px solid var(--border); }
.logo-text { font-family: 'Playfair Display',serif; font-size: 22px; font-weight:600; letter-spacing:.22em; color:var(--text); text-transform:uppercase; }
.logo-text span { color:var(--rose); }
.logo-sub { font-size:10px; color:var(--text-dim); letter-spacing:.12em; text-transform:uppercase; margin-top:3px; }
.sidebar-nav { padding:18px 0; flex:1; overflow-y:auto; }
.nav-section-label { padding:8px 24px 5px; font-size:10px; letter-spacing:.12em; text-transform:uppercase; color:var(--text-dim); }
.nav-item { display:flex; align-items:center; gap:12px; padding:10px 24px; cursor:pointer; color:var(--text-mid); font-size:13px; transition:all .2s; border-left:2px solid transparent; text-decoration:none; }
.nav-item:hover { color:var(--text); background:var(--surface2); }
.nav-item.active { color:var(--text); background:var(--rose-pale); border-left-color:var(--rose); }
.nav-item svg { width:16px; height:16px; flex-shrink:0; }
.sidebar-bottom { padding:18px 24px; border-top:1px solid var(--border); }
.user-info { display:flex; align-items:center; gap:10px; }
.user-avatar { width:32px; height:32px; background:var(--rose-pale); border:1px solid var(--rose); border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:'Playfair Display',serif; font-size:15px; color:var(--rose); }
.user-name { font-size:13px; color:var(--text-mid); }
.user-plan { font-size:10px; color:var(--rose); letter-spacing:.06em; }

/* â”€â”€ CONFIG BANNER â”€â”€ */
.config-banner { background: #2A1F0E; border-bottom: 1px solid rgba(184,154,106,0.3); padding: 10px 36px; display:flex; align-items:center; gap:12px; font-size:12px; color:#C4A265; }
.config-banner svg { width:16px; height:16px; flex-shrink:0; }
.config-banner a { color:#E2C882; text-decoration:underline; cursor:pointer; }
.config-banner.hidden { display:none; }

/* â”€â”€ MAIN â”€â”€ */
.main { margin-left:var(--sidebar-w); flex:1; min-height:100vh; display:flex; flex-direction:column; }
.topbar { background:var(--surface); border-bottom:1px solid var(--border); padding:15px 36px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:40; }
.topbar-title { font-size:15px; font-weight:500; color:var(--text); }
.topbar-actions { display:flex; gap:10px; align-items:center; }
.topbar-date { font-size:12px; color:var(--text-dim); }

.btn { padding:8px 18px; font-family:'DM Sans',sans-serif; font-size:13px; cursor:pointer; border:none; transition:all .2s; letter-spacing:.03em; text-decoration:none; display:inline-flex; align-items:center; gap:6px; }
.btn-sm { padding:6px 13px; font-size:12px; }
.btn-primary { background:var(--rose); color:white; }
.btn-primary:hover { background:var(--rose-dark); }
.btn-surface { background:var(--surface3); color:var(--text-mid); border:1px solid var(--border); }
.btn-surface:hover { color:var(--text); border-color:var(--border2); }
.btn-ghost { background:transparent; color:var(--text-mid); border:1px solid var(--border); }
.btn-ghost:hover { color:var(--text); border-color:var(--border2); }
.btn-danger { background:rgba(196,116,122,.15); color:var(--rose); border:1px solid rgba(196,116,122,.25); }
.btn-danger:hover { background:rgba(196,116,122,.25); }

.content { padding:30px 36px; flex:1; }
.panel { display:none; }
.panel.active { display:block; }

/* â”€â”€ STAT CARDS â”€â”€ */
.stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-bottom:24px; }
.stat-card { background:var(--surface); border:1px solid var(--border); padding:22px; transition:border-color .2s; }
.stat-card:hover { border-color:var(--border2); }
.stat-label { font-size:11px; letter-spacing:.1em; text-transform:uppercase; color:var(--text-dim); margin-bottom:10px; }
.stat-value { font-family:'Playfair Display',serif; font-size:34px; font-weight:400; color:var(--text); line-height:1; margin-bottom:8px; }
.stat-change { font-size:12px; display:flex; align-items:center; gap:4px; }
.stat-change.up { color:var(--green); }
.stat-change.down { color:var(--rose); }

.content-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.card { background:var(--surface); border:1px solid var(--border); overflow:hidden; }
.card-header { padding:18px 22px 14px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.card-title { font-size:14px; font-weight:500; color:var(--text); }
.card-body { padding:18px 22px; }

/* â”€â”€ APPOINTMENTS â”€â”€ */
.appt-list { display:flex; flex-direction:column; gap:9px; }
.appt-item { display:flex; align-items:center; gap:13px; padding:11px; background:var(--surface2); border:1px solid var(--border); }
.appt-time { font-family:'Playfair Display',serif; font-size:18px; font-weight:300; color:var(--text); min-width:50px; text-align:center; line-height:1; }
.appt-time small { display:block; font-size:10px; color:var(--text-dim); font-family:'DM Sans',sans-serif; }
.appt-info { flex:1; }
.appt-name { font-size:13px; color:var(--text); margin-bottom:2px; }
.appt-service { font-size:11px; color:var(--text-mid); }
.appt-status { padding:3px 9px; font-size:10px; letter-spacing:.08em; text-transform:uppercase; }
.status-confirmed { background:var(--green-pale); color:var(--green); border:1px solid rgba(122,170,126,.2); }
.status-pending { background:var(--gold-pale); color:var(--gold); border:1px solid rgba(184,154,106,.2); }
.status-done { background:var(--surface3); color:var(--text-dim); border:1px solid var(--border); }

/* Chart */
.mini-chart { height:100px; display:flex; align-items:flex-end; gap:5px; padding:0 2px; }
.bar { flex:1; background:var(--rose-pale); border-top:1px solid var(--rose); transition:background .2s; cursor:pointer; }
.bar:hover, .bar.highlight { background:rgba(196,116,122,.25); }
.chart-labels { display:flex; gap:5px; padding:5px 2px 0; }
.chart-label { flex:1; text-align:center; font-size:10px; color:var(--text-dim); }

/* â”€â”€ GALLERY â”€â”€ */
.upload-zone { border:2px dashed var(--border2); background:var(--surface2); padding:44px 24px; text-align:center; cursor:pointer; transition:all .3s; margin-bottom:22px; position:relative; }
.upload-zone:hover, .upload-zone.dragover { border-color:var(--rose); background:var(--rose-pale); }
.upload-zone input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; }
.upload-title { font-size:15px; color:var(--text-mid); margin-bottom:6px; }
.upload-hint { font-size:12px; color:var(--text-dim); }
.upload-icon { margin-bottom:12px; color:var(--text-dim); }

/* Progress bar */
.upload-progress { display:none; margin-bottom:22px; background:var(--surface2); border:1px solid var(--border); padding:16px 20px; }
.upload-progress.show { display:block; }
.progress-label { font-size:12px; color:var(--text-mid); margin-bottom:8px; }
.progress-bar-wrap { background:var(--surface3); height:4px; border-radius:2px; overflow:hidden; }
.progress-bar-fill { height:100%; background:var(--rose); border-radius:2px; transition:width .3s; width:0%; }
.progress-files { font-size:11px; color:var(--text-dim); margin-top:8px; }

.gallery-filters { display:flex; gap:7px; margin-bottom:18px; flex-wrap:wrap; }
.filter-btn { padding:6px 14px; background:var(--surface2); border:1px solid var(--border); color:var(--text-mid); font-size:12px; cursor:pointer; transition:all .2s; font-family:'DM Sans',sans-serif; }
.filter-btn.active, .filter-btn:hover { background:var(--rose-pale); border-color:var(--rose); color:var(--rose); }

.gallery-grid-admin { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px; }
.gallery-thumb { position:relative; aspect-ratio:1; background:var(--surface2); overflow:hidden; border:1px solid var(--border); transition:border-color .2s; }
.gallery-thumb:hover { border-color:var(--border2); }
.gallery-thumb img { width:100%; height:100%; object-fit:cover; display:block; transition:transform .3s; }
.gallery-thumb:hover img { transform:scale(1.04); }
.gallery-thumb-overlay { position:absolute; inset:0; background:rgba(15,15,13,.72); opacity:0; transition:opacity .2s; display:flex; flex-direction:column; justify-content:space-between; padding:9px; }
.gallery-thumb:hover .gallery-thumb-overlay { opacity:1; }
.thumb-actions { display:flex; justify-content:flex-end; gap:5px; }
.thumb-btn { width:28px; height:28px; background:rgba(255,255,255,.1); border:none; color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:background .2s; font-size:13px; }
.thumb-btn:hover { background:rgba(255,255,255,.2); }
.thumb-btn.delete:hover { background:rgba(196,116,122,.6); }
.thumb-label { font-size:11px; color:rgba(255,255,255,.8); background:rgba(0,0,0,.4); padding:2px 7px; align-self:flex-start; }
.thumb-loading { position:absolute; inset:0; background:var(--surface2); display:flex; align-items:center; justify-content:center; }
.thumb-spinner { width:24px; height:24px; border:2px solid var(--border2); border-top-color:var(--rose); border-radius:50%; animation:spin .8s linear infinite; }
@keyframes spin { to{transform:rotate(360deg)} }

/* â”€â”€ TABLE â”€â”€ */
.table { width:100%; border-collapse:collapse; }
.table th { text-align:left; padding:10px 15px; font-size:10px; letter-spacing:.1em; text-transform:uppercase; color:var(--text-dim); border-bottom:1px solid var(--border); font-weight:400; }
.table td { padding:12px 15px; font-size:13px; color:var(--text-mid); border-bottom:1px solid var(--border); }
.table tr:hover td { background:var(--surface2); color:var(--text); }
.table td:first-child { color:var(--text); }
.badge { display:inline-block; padding:2px 8px; font-size:10px; letter-spacing:.06em; }
.badge-rose { background:var(--rose-pale); color:var(--rose); border:1px solid rgba(196,116,122,.2); }
.badge-gold { background:var(--gold-pale); color:var(--gold); border:1px solid rgba(184,154,106,.2); }
.badge-green { background:var(--green-pale); color:var(--green); border:1px solid rgba(122,170,126,.2); }

/* â”€â”€ SETTINGS â”€â”€ */
.settings-section { margin-bottom:28px; }
.settings-title { font-size:12px; color:var(--text-mid); text-transform:uppercase; letter-spacing:.1em; margin-bottom:14px; padding-bottom:9px; border-bottom:1px solid var(--border); }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px; }
.form-group { display:flex; flex-direction:column; gap:5px; }
.form-label { font-size:12px; color:var(--text-dim); letter-spacing:.04em; }
.form-input { background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:9px 13px; font-family:'DM Sans',sans-serif; font-size:13px; outline:none; transition:border-color .2s; width:100%; }
.form-input:focus { border-color:var(--rose); }
.form-select { background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:9px 13px; font-family:'DM Sans',sans-serif; font-size:13px; outline:none; width:100%; cursor:pointer; }

/* â”€â”€ LINE SETTINGS â”€â”€ */
.line-setup-box { background:var(--surface2); border:1px solid rgba(6,199,85,.2); padding:24px; margin-bottom:20px; }
.line-setup-header { display:flex; align-items:center; gap:10px; margin-bottom:18px; }
.line-setup-header svg { width:24px; height:24px; color:var(--line); }
.line-setup-header span { font-size:15px; font-weight:500; color:var(--text); }
.line-badge { display:inline-block; padding:2px 8px; background:rgba(6,199,85,.12); color:var(--line); border:1px solid rgba(6,199,85,.2); font-size:11px; letter-spacing:.06em; }
.line-badge.connected { background:rgba(6,199,85,.18); }

/* â”€â”€ MODAL â”€â”€ */
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:200; display:none; align-items:center; justify-content:center; }
.modal-backdrop.open { display:flex; }
.modal { background:var(--surface); border:1px solid var(--border2); width:480px; max-width:95vw; max-height:90vh; overflow-y:auto; }
.modal-header { padding:18px 22px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.modal-title { font-size:15px; color:var(--text); }
.modal-close { background:none; border:none; color:var(--text-dim); cursor:pointer; font-size:18px; padding:4px 8px; transition:color .2s; }
.modal-close:hover { color:var(--text); }
.modal-body { padding:22px; }
.modal-footer { padding:14px 22px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:10px; }

/* â”€â”€ TOAST â”€â”€ */
.toast { position:fixed; bottom:28px; right:28px; background:var(--surface3); border:1px solid var(--border2); padding:13px 18px; font-size:13px; color:var(--text); z-index:300; transform:translateY(16px); opacity:0; transition:all .3s; display:flex; align-items:center; gap:10px; min-width:200px; }
.toast.show { transform:translateY(0); opacity:1; }
.toast-dot { width:8px; height:8px; border-radius:50%; background:var(--green); flex-shrink:0; }
.toast-dot.error { background:var(--rose); }
.toast-dot.loading { background:var(--gold); animation:spin .8s linear infinite; border:2px solid var(--gold); border-top-color:transparent; border-radius:50%; background:transparent; }

::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:var(--surface); }
::-webkit-scrollbar-thumb { background:var(--surface3); }

@media (max-width:1024px) { .stats-grid { grid-template-columns:1fr 1fr; } .content-grid { grid-template-columns:1fr; } }
@media (max-width:768px) { .sidebar { transform:translateX(-100%); } .main { margin-left:0; } .stats-grid { grid-template-columns:1fr 1fr; } }
</style>
</head>
<body>

<!-- â•â• SIDEBAR â•â• -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-text">AU<span>R</span>A</div>
    <div class="logo-sub">å¾Œå°ç®¡ç†ç³»çµ±</div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">ä¸»è¦åŠŸèƒ½</div>
    <a class="nav-item active" data-panel="dashboard">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="6" height="6"/><rect x="9" y="1" width="6" height="6"/><rect x="1" y="9" width="6" height="6"/><rect x="9" y="9" width="6" height="6"/></svg>å„€è¡¨æ¿
    </a>
    <a class="nav-item" data-panel="appointments">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="3" width="12" height="12" rx="1"/><path d="M5 1v4M11 1v4M2 7h12"/></svg>é ç´„ç®¡ç†
    </a>
    <a class="nav-item" data-panel="members">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="5" r="3"/><path d="M2 14c0-3.3 2.7-6 6-6s6 2.7 6 6"/></svg>æœƒå“¡ç®¡ç†
    </a>
    <div class="nav-section-label" style="margin-top:14px">å…§å®¹ç®¡ç†</div>
    <a class="nav-item" data-panel="gallery">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="14" height="14" rx="1"/><circle cx="5.5" cy="5.5" r="1.5"/><path d="M15 11l-4-4L5 15"/></svg>ä½œå“ç›¸ç°¿
    </a>
    <a class="nav-item" data-panel="services">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3h10M3 7h7M3 11h9M3 15h5"/></svg>æœå‹™é …ç›®
    </a>
    <div class="nav-section-label" style="margin-top:14px">å ±è¡¨èˆ‡è¨­å®š</div>
    <a class="nav-item" data-panel="analytics">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 14V7l4-3 4 2 4-5"/><path d="M2 14h12"/></svg>æ¥­ç¸¾åˆ†æ
    </a>
    <a class="nav-item" data-panel="settings">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="2.5"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.42 1.42M11.53 11.53l1.42 1.42M3.05 12.95l1.42-1.42M11.53 4.47l1.42-1.42"/></svg>ç³»çµ±è¨­å®š
    </a>
  </nav>
  <div class="sidebar-bottom">
    <div class="user-info">
      <div class="user-avatar">A</div>
      <div><div class="user-name">ç®¡ç†å“¡</div><div class="user-plan">Pro æ–¹æ¡ˆ</div></div>
    </div>
  </div>
</aside>

<!-- â•â• MAIN â•â• -->
<div class="main">

  <!-- Config banner - shows when keys not set -->
  <div class="config-banner" id="configBanner">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    å°šæœªè¨­å®š Cloudinary / Firebase é‡‘é‘°ã€‚ç…§ç‰‡å°‡æš«å­˜æ–¼æœ¬æ©Ÿã€‚
    <a onclick="showPanel('settings')">å‰å¾€ç³»çµ±è¨­å®š</a> å¡«å…¥é‡‘é‘°å¾Œå³å¯å•Ÿç”¨é›²ç«¯å„²å­˜ã€‚
  </div>

  <div class="topbar">
    <div class="topbar-title" id="panelTitle">å„€è¡¨æ¿</div>
    <div class="topbar-actions">
      <span class="topbar-date" id="currentDate"></span>
      <a href="index.html" class="btn btn-ghost btn-sm">æŸ¥çœ‹å‰å°</a>
    </div>
  </div>

  <div class="content">

    <!-- â”€â”€ DASHBOARD â”€â”€ -->
    <div class="panel active" id="panel-dashboard">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">ä»Šæ—¥é ç´„</div><div class="stat-value">18</div><div class="stat-change up">â†‘ 12% è¼ƒæ˜¨æ—¥</div></div>
        <div class="stat-card"><div class="stat-label">æœ¬æœˆç‡Ÿæ”¶</div><div class="stat-value">$47,820</div><div class="stat-change up">â†‘ 8.3% è¼ƒä¸Šæœˆ</div></div>
        <div class="stat-card"><div class="stat-label">æ´»èºæœƒå“¡</div><div class="stat-value">342</div><div class="stat-change up">â†‘ 5 ä½æ–°å¢</div></div>
        <div class="stat-card"><div class="stat-label">é›²ç«¯ç…§ç‰‡</div><div class="stat-value" id="cloudPhotoCount">â€”</div><div class="stat-change" id="cloudPhotoStatus" style="color:var(--text-dim)">è¼‰å…¥ä¸­...</div></div>
      </div>
      <div class="content-grid">
        <div class="card">
          <div class="card-header"><span class="card-title">ä»Šæ—¥é ç´„</span><button class="btn btn-primary btn-sm" onclick="showPanel('appointments')">æŸ¥çœ‹å…¨éƒ¨</button></div>
          <div class="card-body">
            <div class="appt-list">
              <div class="appt-item"><div class="appt-time">10:00<small>AM</small></div><div class="appt-info"><div class="appt-name">æ—é›…èŠ¸</div><div class="appt-service">å‰ªé«® + è­·é«®ç™‚ç¨‹</div></div><span class="appt-status status-confirmed">å·²ç¢ºèª</span></div>
              <div class="appt-item"><div class="appt-time">11:30<small>AM</small></div><div class="appt-info"><div class="appt-name">é™³ç¾ç²</div><div class="appt-service">å‡è† ç¾ç”² Ã— 2</div></div><span class="appt-status status-pending">å¾…ç¢ºèª</span></div>
              <div class="appt-item"><div class="appt-time">2:00<small>PM</small></div><div class="appt-info"><div class="appt-name">ç‹å®£æ…ˆ</div><div class="appt-service">å«æ¥ç«æ¯› æ—¥ç³»æ¬¾</div></div><span class="appt-status status-confirmed">å·²ç¢ºèª</span></div>
              <div class="appt-item"><div class="appt-time">3:30<small>PM</small></div><div class="appt-info"><div class="appt-name">ææ€¡å›</div><div class="appt-service">å…¨èº«ç²¾æ²¹ SPA</div></div><span class="appt-status status-confirmed">å·²ç¢ºèª</span></div>
              <div class="appt-item"><div class="appt-time">5:00<small>PM</small></div><div class="appt-info"><div class="appt-name">å¼µé›…å©·</div><div class="appt-service">æŸ“é«® + ç‡™é«®</div></div><span class="appt-status status-done">å·²å®Œæˆ</span></div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><span class="card-title">æœ¬é€±æ¥­ç¸¾</span><span style="font-size:12px;color:var(--text-dim)">2026 W8</span></div>
          <div class="card-body">
            <div style="margin-bottom:14px"><div style="font-family:'Playfair Display',serif;font-size:34px;font-weight:300">$47,820</div><div style="font-size:12px;color:var(--green)">â†‘ 8.3% è¼ƒä¸Šé€±</div></div>
            <div class="mini-chart"><div class="bar" style="height:45%"></div><div class="bar" style="height:62%"></div><div class="bar" style="height:38%"></div><div class="bar highlight" style="height:88%"></div><div class="bar" style="height:74%"></div><div class="bar" style="height:55%"></div><div class="bar" style="height:20%"></div></div>
            <div class="chart-labels"><span class="chart-label">ä¸€</span><span class="chart-label">äºŒ</span><span class="chart-label">ä¸‰</span><span class="chart-label">å››</span><span class="chart-label">äº”</span><span class="chart-label">å…­</span><span class="chart-label">æ—¥</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ APPOINTMENTS â”€â”€ -->
    <div class="panel" id="panel-appointments">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:22px">
        <div></div>
        <button class="btn btn-primary" onclick="openModal('apptModal')">+ æ–°å¢é ç´„</button>
      </div>
      <div class="card">
        <div class="card-header"><span class="card-title">æ‰€æœ‰é ç´„</span><select class="form-select" style="width:auto;padding:6px 12px;font-size:12px"><option>å…¨éƒ¨ç‹€æ…‹</option><option>å·²ç¢ºèª</option><option>å¾…ç¢ºèª</option><option>å·²å®Œæˆ</option></select></div>
        <div class="card-body" style="padding:0">
          <table class="table">
            <thead><tr><th>é¡§å®¢</th><th>æœå‹™é …ç›®</th><th>æ—¥æœŸ / æ™‚é–“</th><th>è² è²¬äººå“¡</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead>
            <tbody>
              <tr><td>æ—é›…èŠ¸</td><td>å‰ªé«® + è­·é«®ç™‚ç¨‹</td><td>2026/02/21 10:00</td><td>å°ç²</td><td><span class="badge badge-green">å·²ç¢ºèª</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
              <tr><td>é™³ç¾ç²</td><td>å‡è† ç¾ç”² Ã— 2</td><td>2026/02/21 11:30</td><td>å°èŠ³</td><td><span class="badge badge-gold">å¾…ç¢ºèª</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
              <tr><td>ç‹å®£æ…ˆ</td><td>å«æ¥ç«æ¯› æ—¥ç³»æ¬¾</td><td>2026/02/21 14:00</td><td>å°ç²</td><td><span class="badge badge-green">å·²ç¢ºèª</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
              <tr><td>ææ€¡å›</td><td>å…¨èº«ç²¾æ²¹ SPA</td><td>2026/02/21 15:30</td><td>å°æ¢…</td><td><span class="badge badge-green">å·²ç¢ºèª</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ MEMBERS â”€â”€ -->
    <div class="panel" id="panel-members">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:22px">
        <input class="form-input" placeholder="æœå°‹æœƒå“¡..." style="width:240px">
        <button class="btn btn-primary">+ æ–°å¢æœƒå“¡</button>
      </div>
      <div class="card">
        <div class="card-body" style="padding:0">
          <table class="table">
            <thead><tr><th>å§“å</th><th>é›»è©±</th><th>æ¶ˆè²»æ¬¡æ•¸</th><th>ç´¯è¨ˆæ¶ˆè²»</th><th>æœƒå“¡ç­‰ç´š</th><th>ä¸Šæ¬¡åˆ°è¨ª</th><th>æ“ä½œ</th></tr></thead>
            <tbody>
              <tr><td>æ—é›…èŠ¸</td><td>0912-345-678</td><td>24</td><td>$28,640</td><td><span class="badge badge-rose">VIP</span></td><td>2026/02/18</td><td><button class="btn btn-surface btn-sm">æŸ¥çœ‹</button></td></tr>
              <tr><td>é™³ç¾ç²</td><td>0923-456-789</td><td>8</td><td>$9,320</td><td><span class="badge badge-gold">ä¸€èˆ¬</span></td><td>2026/02/10</td><td><button class="btn btn-surface btn-sm">æŸ¥çœ‹</button></td></tr>
              <tr><td>ç‹å®£æ…ˆ</td><td>0934-567-890</td><td>16</td><td>$15,890</td><td><span class="badge badge-rose">VIP</span></td><td>2026/02/14</td><td><button class="btn btn-surface btn-sm">æŸ¥çœ‹</button></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ GALLERY â”€â”€ -->
    <div class="panel" id="panel-gallery">

      <!-- Cloud status bar -->
      <div id="cloudStatus" style="display:flex;align-items:center;gap:10px;margin-bottom:18px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);font-size:13px;color:var(--text-mid)">
        <div class="thumb-spinner" style="width:16px;height:16px;flex-shrink:0"></div>
        <span id="cloudStatusText">æ­£åœ¨é€£ç·šè‡³ Firebase...</span>
      </div>

      <div class="upload-zone" id="uploadZone">
        <input type="file" id="fileInput" accept="image/*" multiple>
        <div class="upload-icon"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><path d="M17 8l-5-5-5 5M12 3v12"/></svg></div>
        <div class="upload-title">æ‹–æ›³æˆ–é»æ“Šä¸Šå‚³ä½œå“ç…§ç‰‡</div>
        <div class="upload-hint">æ”¯æ´ JPGã€PNGã€WEBPï¼ä¸Šå‚³å¾Œè‡ªå‹•åŒæ­¥è‡³å‰ç«¯</div>
      </div>

      <div class="upload-progress" id="uploadProgress">
        <div class="progress-label" id="progressLabel">ä¸Šå‚³ä¸­ (1/3)...</div>
        <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar"></div></div>
        <div class="progress-files" id="progressFiles"></div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div class="gallery-filters" id="galleryFilters">
          <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
          <button class="filter-btn" data-category="ç¾é«®">ç¾é«®</button>
          <button class="filter-btn" data-category="ç¾ç”²">ç¾ç”²</button>
          <button class="filter-btn" data-category="ç¾ç«">ç¾ç«</button>
          <button class="filter-btn" data-category="ç¾å®¹">ç¾å®¹</button>
          <button class="filter-btn" data-category="SPA">SPA</button>
          <button class="filter-btn" data-category="å…¶ä»–">å…¶ä»–</button>
        </div>
        <span id="photoCount" style="font-size:12px;color:var(--text-dim)">0 å¼µä½œå“</span>
      </div>

      <div class="gallery-grid-admin" id="adminGallery"></div>

      <div id="emptyGallery" style="text-align:center;padding:60px 20px;color:var(--text-dim)">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin:0 auto 14px;display:block;opacity:.25"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
        <p style="font-size:14px">å°šæœªä¸Šå‚³ä»»ä½•ä½œå“</p>
        <p style="font-size:12px;margin-top:5px">ä¸Šå‚³ç…§ç‰‡å¾Œå°‡è‡ªå‹•å„²å­˜è‡³ Cloudinary ä¸¦é¡¯ç¤ºæ–¼å‰ç«¯</p>
      </div>
    </div>

    <!-- â”€â”€ SERVICES â”€â”€ -->
    <div class="panel" id="panel-services">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:22px">
        <div></div><button class="btn btn-primary" onclick="openModal('serviceModal')">+ æ–°å¢æœå‹™</button>
      </div>
      <div class="card">
        <div class="card-body" style="padding:0">
          <table class="table">
            <thead><tr><th>æœå‹™åç¨±</th><th>é¡åˆ¥</th><th>æ™‚é–“</th><th>åƒ¹æ ¼</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead>
            <tbody>
              <tr><td>å‰ªé«® + è­·é«®ç™‚ç¨‹</td><td>ç¾é«®</td><td>90 åˆ†é˜</td><td>$1,200</td><td><span class="badge badge-green">ä¸Šæ¶ä¸­</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
              <tr><td>å‡è† ç¾ç”² åŸºç¤æ¬¾</td><td>ç¾ç”²</td><td>60 åˆ†é˜</td><td>$800</td><td><span class="badge badge-green">ä¸Šæ¶ä¸­</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
              <tr><td>å«æ¥ç«æ¯› æ—¥ç³»æ¬¾</td><td>ç¾ç«</td><td>120 åˆ†é˜</td><td>$1,800</td><td><span class="badge badge-green">ä¸Šæ¶ä¸­</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
              <tr><td>å…¨èº«ç²¾æ²¹ SPA</td><td>SPA æŒ‰æ‘©</td><td>90 åˆ†é˜</td><td>$2,200</td><td><span class="badge badge-green">ä¸Šæ¶ä¸­</span></td><td><button class="btn btn-surface btn-sm">ç·¨è¼¯</button></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ ANALYTICS â”€â”€ -->
    <div class="panel" id="panel-analytics">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">å¹´åº¦ç‡Ÿæ”¶</div><div class="stat-value">$582,400</div><div class="stat-change up">â†‘ 22% è¼ƒå»å¹´</div></div>
        <div class="stat-card"><div class="stat-label">ç¸½æœå‹™ç­†æ•¸</div><div class="stat-value">1,847</div><div class="stat-change up">â†‘ 18% è¼ƒå»å¹´</div></div>
        <div class="stat-card"><div class="stat-label">æ–°å®¢äººæ•¸</div><div class="stat-value">286</div><div class="stat-change up">â†‘ 31% è¼ƒå»å¹´</div></div>
        <div class="stat-card"><div class="stat-label">é¡§å®¢å›è¨ªç‡</div><div class="stat-value">68.4%</div><div class="stat-change up">â†‘ 5.2%</div></div>
      </div>
      <div class="content-grid">
        <div class="card">
          <div class="card-header"><span class="card-title">æœˆåº¦æ¥­ç¸¾è¶¨å‹¢</span></div>
          <div class="card-body">
            <div class="mini-chart" style="height:140px"><div class="bar" style="height:55%"></div><div class="bar" style="height:42%"></div><div class="bar" style="height:68%"></div><div class="bar" style="height:74%"></div><div class="bar" style="height:60%"></div><div class="bar" style="height:85%"></div><div class="bar" style="height:72%"></div><div class="bar" style="height:90%"></div><div class="bar" style="height:78%"></div><div class="bar" style="height:82%"></div><div class="bar" style="height:88%"></div><div class="bar highlight" style="height:100%"></div></div>
            <div class="chart-labels"><span class="chart-label">1</span><span class="chart-label">2</span><span class="chart-label">3</span><span class="chart-label">4</span><span class="chart-label">5</span><span class="chart-label">6</span><span class="chart-label">7</span><span class="chart-label">8</span><span class="chart-label">9</span><span class="chart-label">10</span><span class="chart-label">11</span><span class="chart-label">12</span></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><span class="card-title">ç†±é–€æœå‹™æ’è¡Œ</span></div>
          <div class="card-body">
            <div style="display:flex;flex-direction:column;gap:12px">
              <div><div style="display:flex;justify-content:space-between;margin-bottom:5px"><span style="font-size:13px">å‡è† ç¾ç”²</span><span style="font-size:13px;color:var(--rose)">32%</span></div><div style="height:4px;background:var(--surface3)"><div style="height:100%;width:32%;background:var(--rose)"></div></div></div>
              <div><div style="display:flex;justify-content:space-between;margin-bottom:5px"><span style="font-size:13px">å‰ªé«®è­·é«®</span><span style="font-size:13px;color:var(--gold)">24%</span></div><div style="height:4px;background:var(--surface3)"><div style="height:100%;width:24%;background:var(--gold)"></div></div></div>
              <div><div style="display:flex;justify-content:space-between;margin-bottom:5px"><span style="font-size:13px">å«æ¥ç«æ¯›</span><span style="font-size:13px;color:var(--green)">18%</span></div><div style="height:4px;background:var(--surface3)"><div style="height:100%;width:18%;background:var(--green)"></div></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ SETTINGS â”€â”€ -->
    <div class="panel" id="panel-settings">
      <div style="max-width:760px">

        <!-- Cloudinary -->
        <div class="settings-section">
          <div class="settings-title">Cloudinary åœ–ç‰‡å„²å­˜è¨­å®š</div>
          <div style="font-size:12px;color:var(--text-dim);margin-bottom:14px;line-height:1.7">
            å‰å¾€ <a href="https://cloudinary.com" target="_blank" style="color:var(--rose)">cloudinary.com</a> å…è²»è¨»å†Š â†’ Dashboard å–å¾— Cloud Name â†’ Settings > Upload > Add upload presetï¼ˆMode è¨­ç‚º <b style="color:var(--text)">Unsigned</b>ï¼‰
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Cloud Name</label>
              <input class="form-input" id="cfg-cloud-name" placeholder="ä¾‹å¦‚: mystore123">
            </div>
            <div class="form-group">
              <label class="form-label">Upload Presetï¼ˆUnsignedï¼‰</label>
              <input class="form-input" id="cfg-upload-preset" placeholder="ä¾‹å¦‚: aura_gallery">
            </div>
          </div>
        </div>

        <!-- Firebase -->
        <div class="settings-section">
          <div class="settings-title">Firebase Firestore è³‡æ–™åº«è¨­å®š</div>
          <div style="font-size:12px;color:var(--text-dim);margin-bottom:14px;line-height:1.7">
            å‰å¾€ <a href="https://console.firebase.google.com" target="_blank" style="color:var(--rose)">console.firebase.google.com</a> å»ºç«‹å°ˆæ¡ˆ â†’ æ–°å¢ Web App â†’ å–å¾—è¨­å®šç‰©ä»¶ã€‚<br>Firestore â†’ å»ºç«‹è³‡æ–™åº« â†’ æ¸¬è©¦æ¨¡å¼ï¼ˆä¹‹å¾Œå¯è¨­å®š Rules é™åˆ¶å¯«å…¥ï¼‰
          </div>
          <div class="form-row">
            <div class="form-group"><label class="form-label">API Key</label><input class="form-input" id="cfg-fb-apikey" placeholder="AIzaSy..."></div>
            <div class="form-group"><label class="form-label">Project ID</label><input class="form-input" id="cfg-fb-projectid" placeholder="my-project-123"></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label class="form-label">Auth Domain</label><input class="form-input" id="cfg-fb-authdomain" placeholder="my-project.firebaseapp.com"></div>
            <div class="form-group"><label class="form-label">App ID</label><input class="form-input" id="cfg-fb-appid" placeholder="1:123456:web:abc..."></div>
          </div>
        </div>

        <!-- LINE OA -->
        <div class="settings-section">
          <div class="settings-title">LINE å®˜æ–¹å¸³è™Ÿä¸²æ¥</div>
          <div class="line-setup-box">
            <div class="line-setup-header">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.365 9.89c.50 0 .906.41.906.91s-.406.91-.906.91H17.79v1.049h1.575c.5 0 .906.41.906.91s-.406.91-.906.91H16.88a.908.908 0 01-.906-.91V9.89c0-.5.406-.91.906-.91h2.485zm-4.928 0c.5 0 .906.41.906.91v3.78a.908.908 0 01-.906.91.908.908 0 01-.906-.91V9.89c0-.5.406-.91.906-.91zm-2.203.91v2.87l-1.89-3.39a.906.906 0 00-.79-.39.908.908 0 00-.906.91v3.78c0 .5.406.91.906.91s.906-.41.906-.91v-2.87l1.89 3.39c.164.27.457.39.79.39a.908.908 0 00.906-.91V9.89c0-.5-.406-.91-.906-.91a.908.908 0 00-.906.91zm-4.31-1.82a.908.908 0 00-.906.91v3.78c0 .5.406.91.906.91h2.485c.5 0 .906-.41.906-.91s-.406-.91-.906-.91H8.83V9.89a.908.908 0 00-.906-.91zM12 2C6.477 2 2 6.145 2 11.25c0 4.077 2.625 7.567 6.35 9.04.234.09.197.218.148.544l-.077.483c-.023.148-.11.58.51.316 6.22-2.894 9.97-7.618 9.97-13.383C22 6.145 17.523 2 12 2z"/></svg>
              <span>LINE Messaging API</span>
              <span class="line-badge" id="lineStatusBadge">æœªè¨­å®š</span>
            </div>
            <div class="form-row">
              <div class="form-group"><label class="form-label">Channel Access Token</label><input class="form-input" id="cfg-line-token" placeholder="Bearer xxxxx..."></div>
              <div class="form-group"><label class="form-label">Channel Secret</label><input class="form-input" id="cfg-line-secret" placeholder="abc123..."></div>
            </div>
            <div class="form-group" style="margin-top:8px">
              <label class="form-label">Webhook URLï¼ˆå¡«å…¥ LINE Developers Consoleï¼‰</label>
              <input class="form-input" value="https://your-app.onrender.com/webhook/line" readonly style="color:var(--text-dim)">
            </div>
          </div>
        </div>

        <!-- Store info -->
        <div class="settings-section">
          <div class="settings-title">åº—å®¶åŸºæœ¬è³‡è¨Š</div>
          <div class="form-row">
            <div class="form-group"><label class="form-label">åº—å®¶åç¨±</label><input class="form-input" value="æˆ‘çš„ç¾æ¥­åº—å®¶"></div>
            <div class="form-group"><label class="form-label">ç”¢æ¥­é¡åˆ¥</label><select class="form-select"><option>ç¾é«®æ²™é¾</option><option>ç¾å®¹ç¾é¡</option><option>ç¾ç”²ç¾ç«</option><option>é†«ç¾è¨ºæ‰€</option><option>SPA æŒ‰æ‘©</option><option>é‹å‹•ç‘œä¼½</option><option>å¯µç‰©ç¾å®¹</option><option>æ•´å¾©æ¨æ‹¿</option></select></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label class="form-label">è¯çµ¡é›»è©±</label><input class="form-input" placeholder="02-xxxx-xxxx"></div>
            <div class="form-group"><label class="form-label">ç‡Ÿæ¥­æ™‚é–“</label><input class="form-input" placeholder="é€±äºŒè‡³é€±æ—¥ 10:00 - 20:00"></div>
          </div>
        </div>

        <button class="btn btn-primary" onclick="saveConfig()" style="padding:12px 32px">å„²å­˜æ‰€æœ‰è¨­å®š</button>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- â•â• MODALS â•â• -->
<div class="modal-backdrop" id="apptModal">
  <div class="modal">
    <div class="modal-header"><span class="modal-title">æ–°å¢é ç´„</span><button class="modal-close" onclick="closeModal('apptModal')">Ã—</button></div>
    <div class="modal-body">
      <div style="display:flex;flex-direction:column;gap:12px">
        <div class="form-group"><label class="form-label">é¡§å®¢å§“å</label><input class="form-input" placeholder="å§“åæˆ–æœå°‹æœƒå“¡"></div>
        <div class="form-group"><label class="form-label">æœå‹™é …ç›®</label><select class="form-select"><option>å‰ªé«® + è­·é«®ç™‚ç¨‹</option><option>å‡è† ç¾ç”² åŸºç¤æ¬¾</option><option>å«æ¥ç«æ¯› æ—¥ç³»æ¬¾</option><option>å…¨èº«ç²¾æ²¹ SPA</option></select></div>
        <div class="form-row">
          <div class="form-group"><label class="form-label">æ—¥æœŸ</label><input class="form-input" type="date"></div>
          <div class="form-group"><label class="form-label">æ™‚é–“</label><input class="form-input" type="time" value="10:00"></div>
        </div>
        <div class="form-group"><label class="form-label">å‚™æ³¨</label><input class="form-input" placeholder="ç‰¹æ®Šéœ€æ±‚"></div>
      </div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('apptModal')">å–æ¶ˆ</button><button class="btn btn-primary" onclick="closeModal('apptModal');showToast('é ç´„å·²æ–°å¢')">æ–°å¢é ç´„</button></div>
  </div>
</div>

<div class="modal-backdrop" id="serviceModal">
  <div class="modal">
    <div class="modal-header"><span class="modal-title">æ–°å¢æœå‹™é …ç›®</span><button class="modal-close" onclick="closeModal('serviceModal')">Ã—</button></div>
    <div class="modal-body">
      <div style="display:flex;flex-direction:column;gap:12px">
        <div class="form-group"><label class="form-label">æœå‹™åç¨±</label><input class="form-input" placeholder="æœå‹™åç¨±"></div>
        <div class="form-row">
          <div class="form-group"><label class="form-label">é¡åˆ¥</label><select class="form-select"><option>ç¾é«®</option><option>ç¾ç”²</option><option>ç¾ç«</option><option>ç¾å®¹</option><option>SPA æŒ‰æ‘©</option><option>å…¶ä»–</option></select></div>
          <div class="form-group"><label class="form-label">æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label><input class="form-input" type="number" placeholder="60"></div>
        </div>
        <div class="form-group"><label class="form-label">åƒ¹æ ¼ (NT$)</label><input class="form-input" type="number" placeholder="0"></div>
      </div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('serviceModal')">å–æ¶ˆ</button><button class="btn btn-primary" onclick="closeModal('serviceModal');showToast('æœå‹™å·²æ–°å¢')">æ–°å¢</button></div>
  </div>
</div>

<!-- Label modal -->
<div class="modal-backdrop" id="labelModal">
  <div class="modal">
    <div class="modal-header"><span class="modal-title">è¨­å®šä½œå“è³‡è¨Š</span><button class="modal-close" onclick="closeModal('labelModal')">Ã—</button></div>
    <div class="modal-body">
      <div id="labelPreview" style="width:100%;height:160px;background:var(--surface2);margin-bottom:14px;overflow:hidden;display:flex;align-items:center;justify-content:center"><span style="color:var(--text-dim);font-size:12px">é è¦½åœ–ç‰‡</span></div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:12px" id="labelFileInfo"></div>
      <div class="form-group" style="margin-bottom:12px">
        <label class="form-label">ä½œå“æ¨™é¡Œ</label>
        <input class="form-input" id="labelInput" placeholder="ä¾‹å¦‚ï¼šæ³•å¼æ¼¸å±¤ç¾ç”²">
      </div>
      <div class="form-group">
        <label class="form-label">é¡åˆ¥</label>
        <select class="form-select" id="categoryInput">
          <option value="ç¾é«®">ç¾é«®</option><option value="ç¾ç”²">ç¾ç”²</option>
          <option value="ç¾ç«">ç¾ç«</option><option value="ç¾å®¹">ç¾å®¹</option>
          <option value="SPA">SPA</option><option value="å…¶ä»–">å…¶ä»–</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="skipToNext()">è·³é</button>
      <button class="btn btn-primary" onclick="confirmAndUpload()">ç¢ºèªä¸Šå‚³</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <div class="toast-dot" id="toastDot"></div>
  <span id="toastMsg"></span>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG: load from AURA_CONFIG or localStorage
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CFG_KEY = 'aura_config_v2';

function loadConfig() {
  const saved = localStorage.getItem(CFG_KEY);
  if (saved) {
    try {
      const obj = JSON.parse(saved);
      Object.assign(window.AURA_CONFIG, obj);
    } catch(e) {}
  }
}

loadConfig();

const isConfigured = () =>
  window.AURA_CONFIG.CLOUDINARY_CLOUD_NAME !== 'YOUR_CLOUD_NAME' &&
  window.AURA_CONFIG.FIREBASE_PROJECT_ID !== 'YOUR_PROJECT_ID';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let db = null;

function initFirebase() {
  if (window.AURA_CONFIG.FIREBASE_PROJECT_ID === 'YOUR_PROJECT_ID') return;
  try {
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey:        window.AURA_CONFIG.FIREBASE_API_KEY,
        authDomain:    window.AURA_CONFIG.FIREBASE_AUTH_DOMAIN,
        projectId:     window.AURA_CONFIG.FIREBASE_PROJECT_ID,
        storageBucket: window.AURA_CONFIG.FIREBASE_STORAGE_BUCKET,
        messagingSenderId: window.AURA_CONFIG.FIREBASE_MESSAGING_ID,
        appId:         window.AURA_CONFIG.FIREBASE_APP_ID,
      });
    }
    db = firebase.firestore();
    updateCloudStatus('å·²é€£ç·šè‡³ Firebase âœ“', 'ok');
  } catch(e) {
    updateCloudStatus('Firebase é€£ç·šå¤±æ•—ï¼š' + e.message, 'error');
  }
}

function updateCloudStatus(msg, state) {
  const box = document.getElementById('cloudStatus');
  const txt = document.getElementById('cloudStatusText');
  txt.textContent = msg;
  if (state === 'ok') {
    box.style.borderColor = 'rgba(122,170,126,.3)';
    box.style.background = 'rgba(122,170,126,.06)';
    box.querySelector('.thumb-spinner').style.display = 'none';
    box.insertAdjacentHTML('afterbegin','<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#7AAA7E" stroke-width="2" style="flex-shrink:0"><polyline points="20 6 9 17 4 12"/></svg>');
  } else if (state === 'error') {
    box.style.borderColor = 'rgba(196,116,122,.3)';
    box.querySelector('.thumb-spinner').style.display = 'none';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOUDINARY UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function uploadToCloudinary(file) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', window.AURA_CONFIG.CLOUDINARY_UPLOAD_PRESET);
  formData.append('folder', 'aura_gallery');

  const res = await fetch(
    `https://api.cloudinary.com/v1_1/${window.AURA_CONFIG.CLOUDINARY_CLOUD_NAME}/image/upload`,
    { method: 'POST', body: formData }
  );

  if (!res.ok) throw new Error('Cloudinary ä¸Šå‚³å¤±æ•—');
  const data = await res.json();
  return {
    url: data.secure_url,
    publicId: data.public_id,
    width: data.width,
    height: data.height,
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIRESTORE GALLERY CRUD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function saveImageToFirestore(imgData) {
  if (!db) throw new Error('Firebase æœªåˆå§‹åŒ–');
  const doc = await db.collection('gallery').add({
    ...imgData,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
  });
  return doc.id;
}

async function getImagesFromFirestore() {
  if (!db) throw new Error('Firebase æœªåˆå§‹åŒ–');
  const snap = await db.collection('gallery').orderBy('createdAt', 'desc').get();
  return snap.docs.map(d => ({ id: d.id, ...d.data() }));
}

async function deleteImageFromFirestore(docId) {
  if (!db) throw new Error('Firebase æœªåˆå§‹åŒ–');
  await db.collection('gallery').doc(docId).delete();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FALLBACK: localStorage
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LS_KEY = 'aura_gallery_v2';

function lsGetImages() { try { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); } catch { return []; } }
function lsSaveImages(arr) { localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

async function getImages() {
  if (isConfigured() && db) return getImagesFromFirestore();
  return lsGetImages();
}

async function deleteImage(id, cloudUrl) {
  if (isConfigured() && db) {
    await deleteImageFromFirestore(id);
  } else {
    const imgs = lsGetImages();
    const idx = imgs.findIndex(i => i.id === id);
    if (idx > -1) { imgs.splice(idx, 1); lsSaveImages(imgs); }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPLOAD FLOW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pendingFiles = [];
let currentIdx = 0;
let activeFilter = 'all';
let batchMeta = [];

const fileInput = document.getElementById('fileInput');
const uploadZone = document.getElementById('uploadZone');

fileInput.addEventListener('change', e => handleFiles(e.target.files));

uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
uploadZone.addEventListener('drop', e => { e.preventDefault(); uploadZone.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });

function handleFiles(files) {
  const arr = Array.from(files).filter(f => f.type.startsWith('image/'));
  if (!arr.length) return;
  pendingFiles = arr;
  batchMeta = arr.map(() => ({ label: '', category: 'å…¶ä»–' }));
  currentIdx = 0;
  showLabelModal(0);
}

function showLabelModal(idx) {
  const file = pendingFiles[idx];
  // Preview
  const reader = new FileReader();
  reader.onload = e => {
    const prev = document.getElementById('labelPreview');
    prev.innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;display:block">`;
  };
  reader.readAsDataURL(file);
  document.getElementById('labelFileInfo').textContent = `${idx + 1} / ${pendingFiles.length}  â€”  ${file.name}`;
  document.getElementById('labelInput').value = '';
  document.getElementById('categoryInput').value = 'å…¶ä»–';
  openModal('labelModal');
}

function skipToNext() {
  closeModal('labelModal');
  batchMeta[currentIdx] = { label: pendingFiles[currentIdx].name.replace(/\.[^.]+$/,''), category: 'å…¶ä»–' };
  currentIdx++;
  if (currentIdx < pendingFiles.length) {
    showLabelModal(currentIdx);
  } else {
    startBatchUpload();
  }
}

function confirmAndUpload() {
  closeModal('labelModal');
  batchMeta[currentIdx] = {
    label: document.getElementById('labelInput').value || pendingFiles[currentIdx].name,
    category: document.getElementById('categoryInput').value,
  };
  currentIdx++;
  if (currentIdx < pendingFiles.length) {
    showLabelModal(currentIdx);
  } else {
    startBatchUpload();
  }
}

async function startBatchUpload() {
  const total = pendingFiles.length;
  const prog = document.getElementById('uploadProgress');
  const bar = document.getElementById('progressBar');
  const lbl = document.getElementById('progressLabel');
  const files = document.getElementById('progressFiles');
  prog.classList.add('show');
  showToast('ä¸Šå‚³ä¸­ï¼Œè«‹ç¨å€™...', 'loading');

  for (let i = 0; i < total; i++) {
    const file = pendingFiles[i];
    const meta = batchMeta[i];
    lbl.textContent = `ä¸Šå‚³ä¸­ (${i + 1} / ${total})`;
    files.textContent = file.name;
    bar.style.width = ((i / total) * 100) + '%';

    try {
      let imgData;
      if (isConfigured()) {
        const cloud = await uploadToCloudinary(file);
        imgData = { url: cloud.url, publicId: cloud.publicId, label: meta.label, category: meta.category };
        const docId = await saveImageToFirestore(imgData);
        imgData.id = docId;
      } else {
        // fallback: base64 to localStorage
        const base64 = await fileToBase64(file);
        imgData = { id: Date.now() + '_' + i, url: base64, label: meta.label, category: meta.category };
        const imgs = lsGetImages();
        imgs.unshift(imgData);
        lsSaveImages(imgs);
      }
    } catch(e) {
      showToast('ä¸Šå‚³å¤±æ•—ï¼š' + e.message, 'error');
    }
  }

  bar.style.width = '100%';
  lbl.textContent = `å®Œæˆä¸Šå‚³ ${total} å¼µä½œå“`;
  setTimeout(() => prog.classList.remove('show'), 2000);
  pendingFiles = [];
  batchMeta = [];
  fileInput.value = '';
  await renderGallery();
  showToast(`æˆåŠŸä¸Šå‚³ ${total} å¼µä½œå“ âœ“`);
}

function fileToBase64(file) {
  return new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = e => res(e.target.result);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER GALLERY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderGallery() {
  const grid = document.getElementById('adminGallery');
  const empty = document.getElementById('emptyGallery');
  const countEl = document.getElementById('photoCount');
  grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--text-dim);font-size:13px">è¼‰å…¥ä¸­...</div>';

  try {
    const allImgs = await getImages();
    const filtered = activeFilter === 'all' ? allImgs : allImgs.filter(i => i.category === activeFilter);
    countEl.textContent = `${allImgs.length} å¼µä½œå“`;

    // Update dashboard count
    const dashCount = document.getElementById('cloudPhotoCount');
    const dashStatus = document.getElementById('cloudPhotoStatus');
    if (dashCount) { dashCount.textContent = allImgs.length; }
    if (dashStatus) { dashStatus.textContent = isConfigured() ? 'å·²å„²å­˜æ–¼ Cloudinary' : 'æš«å­˜æ–¼æœ¬æ©Ÿ'; dashStatus.className = 'stat-change ' + (isConfigured() ? 'up' : ''); }

    if (allImgs.length === 0) { grid.innerHTML = ''; empty.style.display = 'block'; return; }
    empty.style.display = 'none';

    grid.innerHTML = filtered.map(img => `
      <div class="gallery-thumb">
        <img src="${img.url}" alt="${img.label}" loading="lazy" onerror="this.style.display='none'">
        <div class="gallery-thumb-overlay">
          <div class="thumb-actions">
            <button class="thumb-btn delete" onclick="deletePhoto('${img.id}', event)" title="åˆªé™¤">âœ•</button>
          </div>
          <span class="thumb-label">${img.label || ''} <span style="opacity:.6;font-size:10px">${img.category || ''}</span></span>
        </div>
      </div>
    `).join('');

  } catch(e) {
    grid.innerHTML = `<div style="grid-column:1/-1;color:var(--rose);padding:20px;font-size:13px">è¼‰å…¥å¤±æ•—ï¼š${e.message}</div>`;
  }
}

async function deletePhoto(id, e) {
  e.stopPropagation();
  if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å¼µä½œå“å—ï¼Ÿ')) return;
  try {
    await deleteImage(id);
    await renderGallery();
    showToast('ç…§ç‰‡å·²åˆªé™¤', 'error');
  } catch(err) {
    showToast('åˆªé™¤å¤±æ•—ï¼š' + err.message, 'error');
  }
}

// Filter
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.dataset.category;
    renderGallery();
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PANEL NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const panelTitles = { dashboard:'å„€è¡¨æ¿', appointments:'é ç´„ç®¡ç†', members:'æœƒå“¡ç®¡ç†', gallery:'ä½œå“ç›¸ç°¿', services:'æœå‹™é …ç›®', analytics:'æ¥­ç¸¾åˆ†æ', settings:'ç³»çµ±è¨­å®š' };

document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => { if (item.dataset.panel) showPanel(item.dataset.panel); });
});

function showPanel(name) {
  document.querySelectorAll('.nav-item').forEach(i => i.classList.toggle('active', i.dataset.panel === name));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  document.getElementById('panelTitle').textContent = panelTitles[name] || name;
  if (name === 'gallery') renderGallery();
  if (name === 'settings') loadConfigToForm();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG SAVE / LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadConfigToForm() {
  const c = window.AURA_CONFIG;
  const set = (id, val) => { const el = document.getElementById(id); if (el && val && !val.startsWith('YOUR_')) el.value = val; };
  set('cfg-cloud-name',     c.CLOUDINARY_CLOUD_NAME);
  set('cfg-upload-preset',  c.CLOUDINARY_UPLOAD_PRESET);
  set('cfg-fb-apikey',      c.FIREBASE_API_KEY);
  set('cfg-fb-projectid',   c.FIREBASE_PROJECT_ID);
  set('cfg-fb-authdomain',  c.FIREBASE_AUTH_DOMAIN);
  set('cfg-fb-appid',       c.FIREBASE_APP_ID);
  set('cfg-line-token',     c.LINE_CHANNEL_TOKEN || '');
  set('cfg-line-secret',    c.LINE_CHANNEL_SECRET || '');
}

function saveConfig() {
  const get = id => document.getElementById(id)?.value.trim() || '';
  const newCfg = {
    CLOUDINARY_CLOUD_NAME:    get('cfg-cloud-name')    || window.AURA_CONFIG.CLOUDINARY_CLOUD_NAME,
    CLOUDINARY_UPLOAD_PRESET: get('cfg-upload-preset') || window.AURA_CONFIG.CLOUDINARY_UPLOAD_PRESET,
    FIREBASE_API_KEY:         get('cfg-fb-apikey')     || window.AURA_CONFIG.FIREBASE_API_KEY,
    FIREBASE_PROJECT_ID:      get('cfg-fb-projectid')  || window.AURA_CONFIG.FIREBASE_PROJECT_ID,
    FIREBASE_AUTH_DOMAIN:     get('cfg-fb-authdomain') || window.AURA_CONFIG.FIREBASE_AUTH_DOMAIN,
    FIREBASE_APP_ID:          get('cfg-fb-appid')      || window.AURA_CONFIG.FIREBASE_APP_ID,
    LINE_CHANNEL_TOKEN:       get('cfg-line-token'),
    LINE_CHANNEL_SECRET:      get('cfg-line-secret'),
  };
  Object.assign(window.AURA_CONFIG, newCfg);
  localStorage.setItem(CFG_KEY, JSON.stringify(newCfg));
  showToast('è¨­å®šå·²å„²å­˜ï¼Œæ­£åœ¨é‡æ–°é€£ç·š...');
  setTimeout(() => { initFirebase(); checkConfigBanner(); }, 600);
}

function checkConfigBanner() {
  document.getElementById('configBanner').classList.toggle('hidden', isConfigured());
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS & TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-backdrop').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); }));

let toastTimer;
function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  const d = document.getElementById('toastDot');
  document.getElementById('toastMsg').textContent = msg;
  d.className = 'toast-dot' + (type === 'error' ? ' error' : type === 'loading' ? ' loading' : '');
  t.classList.add('show');
  clearTimeout(toastTimer);
  if (type !== 'loading') toastTimer = setTimeout(() => t.classList.remove('show'), 3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('currentDate').textContent =
  new Date().toLocaleDateString('zh-TW', { year:'numeric', month:'long', day:'numeric', weekday:'short' });

initFirebase();
checkConfigBanner();

// Auto-load gallery count on dashboard
(async () => {
  try {
    const imgs = await getImages();
    const el = document.getElementById('cloudPhotoCount');
    const st = document.getElementById('cloudPhotoStatus');
    if (el) el.textContent = imgs.length;
    if (st) { st.textContent = isConfigured() ? 'å·²å„²å­˜æ–¼ Cloudinary' : 'æš«å­˜æ–¼æœ¬æ©Ÿ'; }
  } catch(e) {}
})();
</script>
</body>
</html>